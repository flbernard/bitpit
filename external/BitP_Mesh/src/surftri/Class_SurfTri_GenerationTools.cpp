// ========================================================================== //
//                         - Class_SurfTri -                                  //
//                                                                            //
// Grid manager for unstructured meshes.                                      //
// ========================================================================== //
// INFO                                                                       //
// ========================================================================== //
// Author   : Alessandro Alaia                                                //
// Version  : v3.0                                                            //
//                                                                            //
// All rights reserved.                                                       //
// ========================================================================== //

// ========================================================================== //
// INCLUDES                                                                   //
// ========================================================================== //
# include "Class_SurfTri.hpp"

// ========================================================================== //
// IMPLEMENTATIONS                                                            //
// ========================================================================== //

// ADDING TOOLS ============================================================= //

// -------------------------------------------------------------------------- //
void Class_SurfTri::AddVertex(
    darray3E        &V
) {

// ========================================================================== //
// void Class_SurfTri::AddVertex(                                             //
//     dvector1D       &V)                                                    //
//                                                                            //
// Add a vertex to the tasselation                                            //
// ========================================================================== //
// INPUT                                                                      //
// ========================================================================== //
// - V     : dvector1D, vertex coordinates. V[0], V[1], ... are               //
//           the x, y, ... coordinates of vertex to be added.                 //
// ========================================================================== //
// OUTPUT                                                                     //
// ========================================================================== //
// - none                                                                     //
// ========================================================================== //

// ========================================================================== //
// VARIABLES DECLARATION                                                      //
// ========================================================================== //

// Local variables
// - none

// Counters
// - none


// ========================================================================== //
// ADD VERTEX                                                                 //
// ========================================================================== //

// Add vertex to the vertex coordinate list
if (Vertex.size() > nVertex) {
    Vertex[nVertex] = V;
}
else {
    Vertex.push_back(V);
}

// Update the number of vertexes
nVertex++;

return; }

// -------------------------------------------------------------------------- //
void Class_SurfTri::AddVertices(
    dvecarr3E       &V
) {

// ========================================================================== //
// void Class_SurfTri::AddVertices(                                           //
//     dvecarr3E       &V)                                                    //
//                                                                            //
// Add multiple vertexes to the tasselation                                   //
// ========================================================================== //
// INPUT                                                                      //
// ========================================================================== //
// - V     : dvecarr3E, vertex coordinates list. V[i][0], V[i][1], ... are    //
//           the x, y, ... coordinates of the i-th vertex to be added.        //
// ========================================================================== //
// OUTPUT                                                                     //
// ========================================================================== //
// - none                                                                     //
// ========================================================================== //

// ========================================================================== //
// VARIABLES DECLARATION                                                      //
// ========================================================================== //

// Local variables
// none

// Counters
int    i, n = V.size();


// ========================================================================== //
// ADD VERTEX                                                                 //
// ========================================================================== //
for (i = 0; i < n; i++) {
    AddVertex(V[i]);
} //next i

return; }

// -------------------------------------------------------------------------- //
void Class_SurfTri::AddSimplex(
    ivector1D       &E
) {

// ========================================================================== //
// void Class_SurfTri::AddSimplex(                                            //
//     ivector1D       &E)                                                    //
//                                                                            //
// Add simplex to the tasselation                                             //
// ========================================================================== //
// INPUT                                                                      //
// ========================================================================== //
// - E     : ivector1D, simplex-vertex connectivity                           //
// ========================================================================== //
// OUTPUT                                                                     //
// ========================================================================== //
// - none                                                                     //
// ========================================================================== //

// ========================================================================== //
// VARIABLES DECLARATION                                                      //
// ========================================================================== //

// Local variables
// none

// Counters
// none

// ========================================================================== //
// ADD SIMPLES                                                                //
// ========================================================================== //

// Add simplex
if (Simplex.size() > nSimplex) {
    Simplex[nSimplex] = E;
}
else {
    Simplex.push_back(E);
}

// Update number of simplex
nSimplex++;

return; };

// -------------------------------------------------------------------------- //
void Class_SurfTri::AddSimplex(
    dvecarr3E       &V
) {

// ========================================================================== //
// void Class_SurfTri::AddSimplex(                                            //
//     dvecarr3E       &V)                                                    //
//                                                                            //
// Add simplex to the tasselation                                             //
// ========================================================================== //
// INPUT                                                                      //
// ========================================================================== //
// - V     : dvecarr3E, vertex of simplex to be added                         //
// ========================================================================== //
// OUTPUT                                                                     //
// ========================================================================== //
// - none                                                                     //
// ========================================================================== //

// ========================================================================== //
// VARIABLES DECLARATION                                                      //
// ========================================================================== //

// Local variables
int             n = V.size();
ivector1D       dummy(V.size(),-1);

// Counters
int             i;

// ========================================================================== //
// ADD SIMPLES                                                                //
// ========================================================================== //

// Add simplex vertexes
AddVertices(V);

// Add simplex
n = V.size();
for (i = 0; i < n; i++) {
    dummy[i] = nVertex - n + i;
} //next i
AddSimplex(dummy);

return; };

// -------------------------------------------------------------------------- //
void Class_SurfTri::AddSimplicies(
    ivector2D       &E
) {

// ========================================================================== //
// void Class_SurfTri::AddSimplicies(                                         //
//     ivector2D       &E)                                                    //
//                                                                            //
// Add multiple simplicies to the tasselation                                 //
// ========================================================================== //
// INPUT                                                                      //
// ========================================================================== //
// - E     : ivector2D, simplex-vertex connectivity for each simplex          //
//           to be added                                                      //
// ========================================================================== //
// OUTPUT                                                                     //
// ========================================================================== //
// - none                                                                     //
// ========================================================================== //

// ========================================================================== //
// VARIABLES DECLARATION                                                      //
// ========================================================================== //

// Local variables
// none

// Counters
int           i;

// ========================================================================== //
// ADD SIMPLICIES                                                             //
// ========================================================================== //

// Add simplicies
for (i = 0; i < E.size(); i++) {
    AddSimplex(E[i]);
} //next i

return; }

// -------------------------------------------------------------------------- //
void Class_SurfTri::AddSimplicies(
    dvecarr3E       &V,
    ivector2D       &E
) {

// ========================================================================== //
// void Class_SurfTri::AddSimplicies(                                         //
//     dvecarr3E       &V,                                                    //
//     ivector2D       &E)                                                    //
//                                                                            //
// Add multiple simplicies to the tasselation                                 //
// ========================================================================== //
// INPUT                                                                      //
// ========================================================================== //
// - V     : dvecarr3E, vertex coordinate list                                //
// - E     : ivector2D, simplex-vertex connectivity for each simplex          //
//           to be added                                                      //
// ========================================================================== //
// OUTPUT                                                                     //
// ========================================================================== //
// - none                                                                     //
// ========================================================================== //

// ========================================================================== //
// VARIABLES DECLARATION                                                      //
// ========================================================================== //

// Local variables
int           v_off = nVertex;
int           m, n = E.size();
ivector1D     idummy1D;

// Counters
int           i, j;

// ========================================================================== //
// ADD SIMPLES                                                                //
// ========================================================================== //

// Add vertices ------------------------------------------------------------- //
AddVertices(V);

// Add simplicies ----------------------------------------------------------- //
for (i = 0; i < n; i++) {
    m = E[i].size();
    idummy1D.resize(m, -1);
    for (j = 0; j < m; j++) {
        idummy1D[j] = E[i][j] + v_off;
    } //next j
    AddSimplex(idummy1D);
} //next i

return; }

// -------------------------------------------------------------------------- //
void Class_SurfTri::SetNormal(
    int              T,
    darray3E        &n
) {

// ========================================================================== //
// void Class_SurfTri::SetNormal(                                             //
//     int              T,                                                    //
//     dvector1D       &n)                                                    //
//                                                                            //
// Set normal for a specified simplex.                                        //
// ========================================================================== //
// INPUT                                                                      //
// ========================================================================== //
// - T      : int, simplex global index                                       //
// - n      : dvector1D, normal unit vector.                                  //
// ========================================================================== //
// OUTPUT                                                                     //
// ========================================================================== //
// - none                                                                     //
// ========================================================================== //

// ========================================================================== //
// VARIABLES DECLARATION                                                      //
// ========================================================================== //

// Local variables

// Counters
int             i;

// ========================================================================== //
// SET NORMAL VALUE                                                           //
// ========================================================================== //

darray3E    temp;
temp.fill(0.) ;

if (T >= Normal.size()) {
    Normal.resize(T, temp);
}

Normal[T] = n;

return; };

// -------------------------------------------------------------------------- //
void Class_SurfTri::SetAdjacency(
    int              T,
    ivector2D       &a
) {

// ========================================================================== //
// void Class_SurfTri::SetAdjacency(                                          //
//     int              T,                                                    //
//     ivector2D        a)                                                    //
//                                                                            //
// Set adjacency for a specified simplex.                                     //
// ========================================================================== //
// INPUT                                                                      //
// ========================================================================== //
// - T      : int, simplex global index                                       //
// - a      : ivector2D, adjacency list                                       //
// ========================================================================== //
// OUTPUT                                                                     //
// ========================================================================== //
// - none                                                                     //
// ========================================================================== //

// ========================================================================== //
// VARIABLES DECLARATION                                                      //
// ========================================================================== //

// Local variables
// none

// Counters
// none

// ========================================================================== //
// SET ADJACENCY                                                              //
// ========================================================================== //
if (T >= Adjacency.size()) {
    Adjacency.resize(T+1);
}
Adjacency[T] = a;

return; }


// -------------------------------------------------------------------------- //
void Class_SurfTri::Append(
    Class_SurfTri   &Source
) {

// ========================================================================== //
// void Class_SurfTri::Append(                                                //
//     Class_SurfTri   &Source)                                               //
//                                                                            //
// Append tasselation in Source to the present tasselation                    //
// ========================================================================== //
// INPUT                                                                      //
// ========================================================================== //
// - Source   : Class_SurfTri, source tasselation to be appended              //
// ========================================================================== //
// OUTPUT                                                                     //
// ========================================================================== //
// - none                                                                     //
// ========================================================================== //

// ========================================================================== //
// VARIABLES DECLARATION                                                      //
// ========================================================================== //

// Local variables
int        v_off, s_off;

// Counters
int        i, j, m;

darray3E    temp ;
temp.fill(0.) ;

// ========================================================================== //
// INTIIALIZE PARAMETERS                                                      //
// ========================================================================== //

// Vertex offset
v_off = nVertex;

// Simplex offset
s_off = nSimplex;

// ========================================================================== //
// APPEND SIMPLEX IN SOURCE TO THE PRESENT TASSELATION                        //
// ========================================================================== //

// Vertex ------------------------------------------------------------------- //
if (Source.nVertex > 0) {


    // Resize vertex list
    Vertex.resize(nVertex + Source.nVertex, temp);

    // Add vertexes
    AddVertices(Source.Vertex);
}

// Simplex ------------------------------------------------------------------ //
if (Source.nSimplex > 0) {

    // Resize simplex list
    Simplex.resize(nSimplex + Source.nSimplex);

    // Add simplex
    for (i = 0; i < Source.nSimplex; i++) {
        Simplex[i + s_off] = Source.Simplex[i] + v_off;
        nSimplex++;
    } //next i
}

// Normals ------------------------------------------------------------------ //
if ((Source.Normal.size() > 0) && (Source.Normal.size() >= Source.nSimplex)) {

    // Resize normal list
    Normal.resize(nSimplex, temp);

    // Add normals
    for (i = 0; i < Source.nSimplex; i++) {
        Normal[i + s_off] = Source.Normal[i];
    } //next i
}

// Adjacencies -------------------------------------------------------------- //
if ((Source.Adjacency.size() > 0) && (Source.Adjacency.size() >= Source.nSimplex)) {

    // Resize adjacency list
    Adjacency.resize(nSimplex);

    // Add adjacencies
    for (i = 0; i < Source.nSimplex; i++) {
        Adjacency[i + s_off].resize(Source.Adjacency[i].size());
        m = Source.Adjacency[i].size();
        for (j = 0; j < m; j++) {
            if (Source.Adjacency[i][j][0] >= 0) {
                Adjacency[i + s_off][j] = Source.Adjacency[i][j] + s_off;
            }
            else {
                Adjacency[i + s_off][j].resize(1, -1);
            }
        } //next j
    } //next i
}

return; };

// TRANSFORMATION TOOLS ===================================================== //

// -------------------------------------------------------------------------- //
void Class_SurfTri::Scale(
    double           sx,
    double           sy,
    double           sz
) {

// ========================================================================== //
// void Class_SurfTri::Scale(                                                 //
//     double           sx,                                                   //
//     double           sy,                                                   //
//     double           sz)                                                   //
//                                                                            //
// Scale tasselation along x, y, z axis by factor sx, sy and sz               //
// respectively.                                                              //
// ========================================================================== //
// INPUT                                                                      //
// ========================================================================== //
// - sx     : double, scaling factor along x direction                        //
// - sy     : double, scaling factor along y direction                        //
// - sz     : double, scaling factor along z direction                        //
// ========================================================================== //
// OUTPUT                                                                     //
// ========================================================================== //
// - none                                                                     //
// ========================================================================== //

// ========================================================================== //
// VARIABLES DECLARATION                                                      //
// ========================================================================== //

// Local variables
// none

// Counters
int      i;

// ========================================================================== //
// SCALE TASSELATION                                                          //
// ========================================================================== //

// Vertex ------------------------------------------------------------------- //
for (i = 0; i < nVertex; i++) {
    Vertex[i][0] = sx*Vertex[i][0];
    Vertex[i][1] = sy*Vertex[i][1];
    Vertex[i][2] = sz*Vertex[i][2];
} //next i

// Normals ------------------------------------------------------------------ //
if ((Normal.size() > 0) && (Normal.size() >= nSimplex)) {
    GenerateNormals();
}

return; };

// -------------------------------------------------------------------------- //
void Class_SurfTri::Translate(
    double           sx,
    double           sy,
    double           sz
) {

// ========================================================================== //
// void Class_SurfTri::Translate(                                             //
//     double           sx,                                                   //
//     double           sy,                                                   //
//     double           sz)                                                   //
//                                                                            //
// Translate tasselation along x, y, z by sx, sy and sz (respectively)        //
// ========================================================================== //
// INPUT                                                                      //
// ========================================================================== //
// - sx      : double, translation along x direction                          //
// - sy      : double, translation along y direction                          //
// - sz      : double, translation along z direction                          //
// ========================================================================== //
// OUTPUT                                                                     //
// ========================================================================== //
// - none                                                                     //
// ========================================================================== //

// ========================================================================== //
// VARIABLES DECLARATION                                                      //
// ========================================================================== //

// Local variables
// none


// Counters
int       i;

// ========================================================================== //
// TRANSLATE VERTEX                                                           //
// ========================================================================== //
for (i = 0; i < nVertex; i++) {
    Vertex[i][0] += sx;
    Vertex[i][1] += sy;
    Vertex[i][2] += sz;
} //next i

return; };
